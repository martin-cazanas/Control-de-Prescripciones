-- USE MASTER DROP DATABASE CTRL_PRES
CREATE DATABASE CTRL_PRES
GO
USE CTRL_PRES
GO
CREATE TABLE Analistas(
    ID NUMERIC IDENTITY(0,1),
    Nombre VARCHAR(100),
    Usuario VARCHAR(25),
    Jefe BIT,
    Division NUMERIC,
    Estatus BIT DEFAULT 1,
    PRIMARY KEY(ID),
    CONSTRAINT ANALSITAS_JEFE FOREIGN KEY(Division) REFERENCES Analistas(ID)
)
INSERT INTO Analistas VALUES('SIN ANALISTA', NULL, NULL, NULL, 0)

CREATE TABLE Clasificaciones(
    ID NUMERIC IDENTITY(1,1),
    Descripcion VARCHAR(100)
    PRIMARY KEY(ID)
)

CREATE TABLE Tipos(
    ID NUMERIC IDENTITY(1,1),
    Descripcion VARCHAR(100),
    PRIMARY KEY(ID)
)

CREATE TABLE Estatus(
    ID NUMERIC IDENTITY(1,1),
    Descripcion VARCHAR(100),
    Tipo BIT,
    PRIMARY KEY(ID)
)

CREATE TABLE SIDEC(
    ID NUMERIC IDENTITY(1,1),
    Pieza VARCHAR(50),
    Promovente VARCHAR(MAX),
    Denunciado VARCHAR(MAX),
    Expediente VARCHAR(30),
    Folio_Ciu VARCHAR(20),
    Clave VARCHAR(50),
    Analista NUMERIC,
    Division NUMERIC,
    Concluido BIT DEFAULT 0,
    Estatus NUMERIC,
    Narracion VARCHAR(MAX),
    Clasificacion NUMERIC,
    Tipo NUMERIC,
    Conclusion VARCHAR(7), 
    Recepcion SMALLDATETIME,
    Registro SMALLDATETIME,
    Ultimo SMALLDATETIME DEFAULT NULL, 
    PRIMARY KEY(ID),
    CONSTRAINT SIDEC_ANALISTAS FOREIGN KEY(Analista) REFERENCES Analistas(ID),
    CONSTRAINT SIDEC_DIVISION FOREIGN KEY(Division) REFERENCES Analistas(ID),
    CONSTRAINT SIDEC_ESTATUS FOREIGN KEY(Estatus) REFERENCES Estatus(ID),
    CONSTRAINT SIDEC_CLASIFICACION FOREIGN KEY(Clasificacion) REFERENCES Clasificaciones(ID),
    CONSTRAINT SIDEC_TIPO FOREIGN KEY(Tipo) REFERENCES Tipos(ID)
)

CREATE INDEX Expedientes_SIDEC ON SIDEC(Expediente)

CREATE TABLE Origenes(
    ID NUMERIC IDENTITY(1,1),
    Descripcion VARCHAR(100),
    PRIMARY KEY(ID)
)

CREATE TABLE SANC(
    ID NUMERIC IDENTITY(1,1),
    Pieza NUMERIC,
    Denunciante VARCHAR(100),
    Denunciado VARCHAR(100),
    Origen NUMERIC,
    Dependencia_Origen VARCHAR(50),
    Expediente_Origen VARCHAR(30),
    Expediente VARCHAR(16) UNIQUE,
    Analista NUMERIC,
    Division NUMERIC,
    Estatus NUMERIC,
    Narracion VARCHAR(MAX),
    Conclusion VARCHAR(7), 
    Registro SMALLDATETIME,
    Recepcion SMALLDATETIME,
    PA VARCHAR(100),
    PRIMARY KEY(ID),
    CONSTRAINT SANC_ORIGENES FOREIGN KEY(Origen) REFERENCES Origenes(ID),
    CONSTRAINT SANC_ANALISTAS FOREIGN KEY(Analista) REFERENCES Analistas(ID),
    CONSTRAINT SANC_DIVISION FOREIGN KEY(Division) REFERENCES Analistas(ID),
    CONSTRAINT SANC_ESTATUS FOREIGN KEY(Estatus) REFERENCES Estatus(ID)
)

CREATE INDEX Expedientes_SANC ON SANC(Expediente)

CREATE TABLE Orden(
    ID NUMERIC IDENTITY(1,1),
    Ano VARCHAR(4),
    Analista NUMERIC,
    Division NUMERIC,
    Turno BIT,
    Estatus NUMERIC DEFAULT 1,
    PRIMARY KEY(ID),
    CONSTRAINT ORDEN_ANALISTAS FOREIGN KEY(Analista) REFERENCES Analistas(ID),
    CONSTRAINT ORDEN_DIVISION FOREIGN KEY(Division) REFERENCES Analistas(ID)
)

CREATE TABLE Turnos(
    ID NUMERIC IDENTITY(1,1),
    Ano VARCHAR(4),
    Analista NUMERIC,
    Division NUMERIC,
    Descripcion BIT,
    PRIMARY KEY(ID),
    CONSTRAINT TURNOS_ANALISTAS FOREIGN KEY(Analista) REFERENCES Analistas(ID),
    CONSTRAINT TURNOS_DIVISION FOREIGN KEY(Division) REFERENCES Analistas(ID)
)